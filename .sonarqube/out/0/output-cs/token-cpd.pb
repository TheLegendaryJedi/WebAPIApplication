ã"
K/Users/goncaloatanasio/RiderProjects/quickstart/01-authorization/Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. 
AddCors 
( 
options  
=>! #
{ 
options 
. 
	AddPolicy 
( 
$str +
,+ ,
builder 
=> 
{ 	
builder 
. 
WithOrigins 
( 
$str 0
)0 1
. 
AllowAnyMethod 
( 
) 
. 
AllowAnyHeader 
( 
) 
. 
AllowCredentials 
( 
) 
;  
} 	
)	 

;
 
} 
) 
; 
var 
domain 

= 
$" 
$str 
{ 
builder 
.  
Configuration  -
[- .
$str. <
]< =
}= >
$str> ?
"? @
;@ A
builder%% 
.%% 
Services%% 
.%% (
AddAuth0WebAppAuthentication%% -
(%%- .
options%%. 5
=>%%6 8
{&& 
options'' 
.'' 
Domain'' 
='' 
builder'' 
.'' 
Configuration'' *
[''* +
$str''+ 9
]''9 :
;'': ;
options(( 
.(( 
ClientId(( 
=(( 
builder(( 
.(( 
Configuration(( ,
[((, -
$str((- =
]((= >
;((> ?
})) 
))) 
;)) 
builder++ 
.++ 
Services++ 
.++ 
AddAuthorization++ !
(++! "
options++" )
=>++* ,
{,, 
options-- 
.-- 
	AddPolicy-- 
(-- 
$str-- %
,--% &
policy--' -
=>--. 0
policy--1 7
.--7 8
Requirements--8 D
.--D E
Add--E H
(--H I
new--I L
HasScopeRequirement--M `
(--` a
$str--a p
,--p q
domain--r x
)--x y
)--y z
)--z {
;--{ |
}.. 
).. 
;.. 
builder00 
.00 
Services00 
.00 
AddControllers00 
(00  
)00  !
;00! "
builder11 
.11 
Services11 
.11 
AddSingleton11 
<11 !
IAuthorizationHandler11 3
,113 4
HasScopeHandler115 D
>11D E
(11E F
)11F G
;11G H
var33 
app33 
=33 	
builder33
 
.33 
Build33 
(33 
)33 
;33 
if55 
(55 
!55 
app55 
.55 	
Environment55	 
.55 
IsDevelopment55 "
(55" #
)55# $
)55$ %
{66 
app77 
.77 %
UseDeveloperExceptionPage77 !
(77! "
)77" #
;77# $
}99 
else:: 
{;; 
app== 
.== 
UseHsts== 
(== 
)== 
;== 
}>> 
appAA 
.AA 
UseHttpsRedirectionAA 
(AA 
)AA 
;AA 
appCC 
.CC 

UseRoutingCC 
(CC 
)CC 
;CC 
appEE 
.EE 
UseCorsEE 
(EE 
$strEE !
)EE! "
;EE" #
appFF 
.FF 
UseAuthenticationFF 
(FF 
)FF 
;FF 
appGG 
.GG 
UseAuthorizationGG 
(GG 
)GG 
;GG 
appHH 
.HH 
UseEndpointsHH 
(HH 
	endpointsHH 
=>HH 
{II 
	endpointsJJ 
.JJ 
MapControllersJJ 
(JJ 
)JJ 
;JJ 
}KK 
)KK 
;KK 
appMM 
.MM 
RunMM 
(MM 
)MM 	
;MM	 
Å
]/Users/goncaloatanasio/RiderProjects/quickstart/01-authorization/Controllers/ApiController.cs
	namespace		 	
WebAPIApplication		
 
.		 
Controllers		 '
{

 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
ApiController 
:  
ControllerBase! /
{ 
[ 	
HttpGet	 
( 
$str 
) 
] 
public 
IActionResult 
Public #
(# $
)$ %
{ 	
return 
Ok 
( 
new 
{ 
Message 
= 
$str i
} 
) 
; 
} 	
[ 	
HttpGet	 
( 
$str 
) 
] 
[ 	
	Authorize	 
] 
public 
IActionResult 
Private $
($ %
)% &
{ 	
return 
Ok 
( 
new 
{ 
Message 
= 
$str d
}   
)   
;   
}!! 	
[## 	
HttpGet##	 
(## 
$str## !
)##! "
]##" #
[$$ 	
	Authorize$$	 
($$ 
$str$$ "
)$$" #
]$$# $
public%% 
IActionResult%% 
Scoped%% #
(%%# $
)%%$ %
{&& 	
return'' 
Ok'' 
('' 
new'' 
{(( 
Message)) 
=)) 
$str	)) †
}** 
)** 
;** 
}++ 	
[.. 	
HttpGet..	 
(.. 
$str.. 
).. 
].. 
public// 
IActionResult// 
Claims// #
(//# $
)//$ %
{00 	
return11 
Ok11 
(11 
User11 
.11 
Claims11 !
.11! "
Select11" (
(11( )
c11) *
=>11+ -
new22 
{33 
c44 
.44 
Type44 
,44 
c55 
.55 
Value55 
}66 
)66 
)66 
;66 
}77 	
}88 
}99 „

W/Users/goncaloatanasio/RiderProjects/quickstart/01-authorization/HasScopeRequirement.cs
	namespace 	
WebAPIApplication
 
{ 
public 

class 
HasScopeRequirement $
:% &%
IAuthorizationRequirement' @
{ 
public 
string 
Issuer 
{ 
get "
;" #
}$ %
public		 
string		 
Scope		 
{		 
get		 !
;		! "
}		# $
public 
HasScopeRequirement "
(" #
string# )
scope* /
,/ 0
string1 7
issuer8 >
)> ?
{ 	
Scope 
= 
scope 
?? 
throw "
new# &!
ArgumentNullException' <
(< =
nameof= C
(C D
scopeD I
)I J
)J K
;K L
Issuer 
= 
issuer 
?? 
throw $
new% (!
ArgumentNullException) >
(> ?
nameof? E
(E F
issuerF L
)L M
)M N
;N O
} 	
} 
} ·
S/Users/goncaloatanasio/RiderProjects/quickstart/01-authorization/HasScopeHandler.cs
	namespace 	
WebAPIApplication
 
{ 
public 

class 
HasScopeHandler  
:! " 
AuthorizationHandler# 7
<7 8
HasScopeRequirement8 K
>K L
{ 
	protected		 
override		 
Task		 "
HandleRequirementAsync		  6
(		6 7'
AuthorizationHandlerContext		7 R
context		S Z
,		Z [
HasScopeRequirement		\ o
requirement		p {
)		{ |
{

 	
if 
( 
! 
context 
. 
User 
. 
HasClaim &
(& '
c' (
=>) +
c, -
.- .
Type. 2
==3 5
$str6 =
&&> @
cA B
.B C
IssuerC I
==J L
requirementM X
.X Y
IssuerY _
)_ `
)` a
return 
Task 
. 
CompletedTask )
;) *
var 
scopes 
= 
context  
.  !
User! %
.% &
	FindFirst& /
(/ 0
c0 1
=>2 4
c5 6
.6 7
Type7 ;
==< >
$str? F
&&G I
cJ K
.K L
IssuerL R
==S U
requirementV a
.a b
Issuerb h
)h i
.i j
Valuej o
.o p
Splitp u
(u v
$charv y
)y z
;z {
if 
( 
scopes 
. 
Any 
( 
s 
=> 
s  !
==" $
requirement% 0
.0 1
Scope1 6
)6 7
)7 8
context 
. 
Succeed 
(  
requirement  +
)+ ,
;, -
return 
Task 
. 
CompletedTask %
;% &
} 	
} 
} ¯
a/Users/goncaloatanasio/RiderProjects/quickstart/01-authorization/Controllers/AccountController.cs
	namespace		 	
WebAPIApplication		
 
.		 
Controllers		 '
;		' (
public 
class 
AccountController 
:  
ControllerBase! /
{ 
[ 
Route 

(
 
$str 
) 
] 
public 

async 
Task 
Signup 
( 
string #
	returnUrl$ -
=. /
$str0 :
): ;
{ 
var $
authenticationProperties $
=% &
new' *0
$LoginAuthenticationPropertiesBuilder+ O
(O P
)P Q
. 
WithParameter 
( 
$str (
,( )
$str* 2
)2 3
. 
WithRedirectUri 
( 
	returnUrl &
)& '
. 
Build 
( 
) 
; 
await 
HttpContext 
. 
ChallengeAsync (
(( )
Auth0Constants) 7
.7 8 
AuthenticationScheme8 L
,L M$
authenticationPropertiesN f
)f g
;g h
} 
[ 
Route 

(
 
$str 
) 
] 
public 

async 
Task 
Login 
( 
string "
	returnUrl# ,
=- .
$str/ 6
)6 7
{ 
var $
authenticationProperties $
=% &
new' *0
$LoginAuthenticationPropertiesBuilder+ O
(O P
)P Q
. 
WithRedirectUri 
( 
	returnUrl &
)& '
. 
Build 
( 
) 
; 
await!! 
HttpContext!! 
.!! 
ChallengeAsync!! (
(!!( )
Auth0Constants!!) 7
.!!7 8 
AuthenticationScheme!!8 L
,!!L M$
authenticationProperties!!N f
)!!f g
;!!g h
}"" 
[$$ 
	Authorize$$ 
]$$ 
[%% 
Route%% 

(%%
 
$str%% 
)%% 
]%% 
public&& 

async&& 
Task&& 
Logout&& 
(&& 
)&& 
{'' 
var(( $
authenticationProperties(( $
=((% &
new((' *1
%LogoutAuthenticationPropertiesBuilder((+ P
(((P Q
)((Q R
.,, 
WithRedirectUri,, 
(,, 
$str,, $
),,$ %
.-- 
Build-- 
(-- 
)-- 
;-- 
await// 
HttpContext// 
.// 
SignOutAsync// &
(//& '
Auth0Constants//' 5
.//5 6 
AuthenticationScheme//6 J
,//J K$
authenticationProperties//L d
)//d e
;//e f
await00 
HttpContext00 
.00 
SignOutAsync00 &
(00& '(
CookieAuthenticationDefaults00' C
.00C D 
AuthenticationScheme00D X
)00X Y
;00Y Z
Response11 
.11 
Cookies11 
.11 
Delete11 
(11  
$str11  5
)115 6
;116 7
}22 
[44 
	Authorize44 
]44 
[55 
Route55 

(55
 
$str55 
)55 
]55 
public66 

IActionResult66 
Home66 
(66 
)66 
{77 
return88 
Ok88 
(88 
new88 
{99 	
Message:: 
=:: 
$str:: `
};; 	
);;	 

;;;
 
}<< 
}== 